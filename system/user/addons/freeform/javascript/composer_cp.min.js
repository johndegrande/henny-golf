(function(global,$){"use strict";var $captchaButton;var $composer;var $composerRows;var $context;var $doubleRow;var $dynamicRecipientsButton;var $titleButton;var $pageBreakButton;var $paragraphButton;var $quadrupleRow;var $searchClear;var $singleRow;var $submitButtonButton;var $submitPreviousButtonButton;var $tripleRow;var $userRecipientsButton;var $composerSideBar;var $stickyControls;var $elMcpNav;var $mcpNav;var $navTemplate;var columnTemplate;var captchaTemplate;var column;var composerRow;var composerRowTemplate;var dynrec;var dynrecTemplate;var editDynrec;var editDynrecTemplate;var editParagraph;var editParagraphTemplate;var editSubmit;var editSubmitTemplate;var editSubmitPrevious;var editSubmitPreviousTemplate;var editUserrec;var editUserrecTemplate;var fieldDrag;var fieldDragTemplate;var fieldTag;var fieldTagTemplate;var fieldWrapper;var fieldWrapperTemplate;var pageBreakTemplate;var paragraph;var paragraphTemplate;var submitButton;var submitButtonTemplate;var submitPreviousButton;var submitPreviousButtonTemplate;var textareaTemplate;var userrec;var userrecTemplate;var toggleNavTemplate;var sortOut=false;var missingSubmits=false;var insertOutputs={};var rowTemplates={};var hiddenFields=[];var fieldFancyboxDefaults={width:"90%",overlayOpacity:"0.75",onStart:function(){$("#fancybox-content").addClass("solspace_ui_wrapper")}};var nonfieldReauireable=["dynamic_recipients","user_recipients","captcha"];function setRowButtonEvents($buttonObj,name,count){var colspan=12/count;var blanks=[];var i=count;while(i--){blanks.push("")}var template=composerRow({data:blanks,colspan:colspan.toString()});rowTemplates[name]=template;$buttonObj.click(function(){var $element=$(template).appendTo($composerRows);updateRowEvents($element,"row")});$buttonObj.draggable({connectToSortable:"#composer_rows",forceHelperSize:true,zIndex:50,helper:function(){sortOut=false;var $clone=$(this).clone().addClass("insert_element_width").height($(this).outerHeight()).remove().appendTo($composer).css("zIndex",55);return $clone}})}function setFieldDragging($buttonObj){$buttonObj=$buttonObj||false;if($buttonObj===false){$(".field_tag").each(function(){setFieldDragging($(this))});return}$buttonObj.draggable({connectToSortable:"#composer .connectedSortable",revert:true,revertDuration:0,zIndex:50,helper:function(){var $item=$(fieldDrag({fieldLabel:$buttonObj.text()}));if($buttonObj.is(".field_tag")){$item.addClass("field_tag");$item.attr("data-field-name",$buttonObj.attr("data-field-name"))}else if($buttonObj.is(".insert_element")){$item.addClass("insert_element");$item.attr("data-element-id",$buttonObj.attr("data-element-id"))}var ret=$item.remove().appendTo($composer).css("zIndex",55).get(0);return ret},start:function(e,ui){ui.helper.width(ui.helper.outerWidth())}})}function setInsertButtonEvent($buttonObj,element,disableOnInsert){disableOnInsert=disableOnInsert||false;var elementId=$buttonObj.attr("data-element-id");insertOutputs[elementId]=fieldWrapper({elementId:"nonfield_"+elementId,element:element,requireable:$.inArray(elementId,nonfieldReauireable)>-1?"yes":"no"});$buttonObj.click(function(){var template=composerRow({data:[insertOutputs[elementId]],colspan:"12"});var $element=$(template).appendTo($composerRows);updateRowEvents($element,"row")});setFieldDragging($buttonObj)}function updateRowEvents($element,type){$composerRows.sortable("refresh");$composerRows.find("tr:not(.no_sort) td:not(.row_control_holder)").sortable({connectWith:"#composer .connectedSortable",items:".element_wrapper",handle:".element_cover",forcePlaceholderSize:false,stop:function(event,ui){var $that=$(this);var $item=ui.item;if(ui.item.is(".field_tag")){var fieldName=ui.item.attr("data-field-name");var $original=$('div.field_tag[data-field-name="'+fieldName+'"]:not(.field_dragger)');if($original.hasClass("disabled")){$item.remove()}else{$item.replaceWith(fieldOutput(fieldName));setTimeout(function(){updateRowEvents($that);checkRemovedFields()},0)}}else if(ui.item.is(".insert_element")){var elementId=ui.item.attr("data-element-id");$item.replaceWith(insertOutputs[elementId]);setTimeout(function(){updateRowEvents($that);checkRemovedFields()},0)}return ui},start:function(e,ui){if(ui.helper.width()>400){ui.helper.width(400)}ui.helper.height(ui.helper.css("height","").outerHeight());return ui}});checkRowControls()}function checkRemovedFields(){var $wrappers=$composer.find(".element_wrapper[data-element-id]:"+'not([data-element-id^="nonfield"])');var $fields=$("#field_list .field_tag");var fieldDict={};$fields.removeClass("disabled");if($wrappers.length>0){$fields.each(function(){var $that=$(this);fieldDict[$that.attr("data-field-name")]=$that});$wrappers.each(function(){if(typeof fieldDict[$(this).attr("data-element-id")]==="undefined"){return}fieldDict[$(this).attr("data-element-id")].addClass("disabled")})}}function checkRowControls(){$(".row_control").each(function(){var $that=$(this),$tr=$that.parent().parent(),total=$tr.find("td").length;if(total==5){$that.find(".row_add_column").addClass("disabled")}else{$that.find(".row_add_column").removeClass("disabled")}if(total==2){$that.find(".row_remove_column").addClass("disabled")}else{$that.find(".row_remove_column").removeClass("disabled")}})}function fieldModalEvents(fancyboxObject,isUpdate){var $fieldEditForm=$("#edit_field form:first");var formUrl=$fieldEditForm.attr("action");var update=isUpdate||false;Freeform.initFieldEvents();$fieldEditForm.submit(function(e){e.preventDefault();var postData=$fieldEditForm.serializeArray();postData.push({name:"include_field_data",value:"true"});postData=$.param(postData);$.fancybox.showActivity();$.post(formUrl,postData,function(data){$(".validation_error_holder").hide();if(!data.success){$.fancybox.hideActivity();Freeform.showValidationErrors(data.errors,$fieldEditForm)}else if(update!==false){updateField(update,data,function(){$.fancybox.hideActivity();$.fancybox.close()})}else{addNewField(data,function(){$.fancybox.hideActivity();$.fancybox.close()})}},"json");return false});setTimeout(function(){$("#fancybox-wrap").stop().css({top:"50px"})},0)}function updateField(oldName,data,callback){if(data.success){var fieldName=data.composerFieldData.fieldName;var fieldId=data.composerFieldData.fieldId;Freeform.composerFieldData[fieldName]=data.composerFieldData;if(oldName!=fieldName){$('.field_tag[data-field-name="'+oldName+'"]').attr("data-field-name",fieldName);$('.element_wrapper[data-element-id="'+oldName+'"]').attr("data-element-id",fieldName)}var $fieldTag=$('.field_tag[data-field-name="'+fieldName+'"]');var isDisabled=$fieldTag.hasClass("disabled");$fieldTag.replaceWith(fieldTag({fieldName:fieldName,fieldLabel:data.composerFieldData.fieldLabel}));if(isDisabled){$('.field_tag[data-field-name="'+fieldName+'"]').addClass("disabled")}$('.element_wrapper[data-element-id="'+fieldName+'"]').replaceWith(fieldOutput(fieldName));updateRowEvents();setFieldDragging()}if(typeof callback=="function"){callback()}}function addNewField(data,callback){if(data.success){var fieldName=data.composerFieldData.fieldName;var fieldId=data.composerFieldData.fieldId;Freeform.composerFieldData[fieldName]=data.composerFieldData;Freeform.composerFieldIdList[fieldName]=fieldId;$("#field_list").append(fieldTag({fieldName:fieldName,fieldLabel:data.composerFieldData.fieldLabel}));setFieldDragging()}if(typeof callback==="function"){callback()}}function fieldOutput(fieldName,required){return fieldWrapper({elementId:fieldName,elementLabel:Freeform.composerFieldData[fieldName].fieldLabel,element:window.atob(Freeform.composerFieldData[fieldName].fieldOutput),required:required||"no"})}function getComposerRows(validate){validate=validate||false;var $trs=$("#composer_rows tr");var rows=[];var fields=[];var multipage=false;var hasSubmitThisRow=false;missingSubmits=false;$trs.each(function(){var row=[];var $row=$(this);var $tds=$row.find("td:not(.row_control_holder)");if($row.hasClass("page_break_holder")){multipage=true;if(!hasSubmitThisRow){missingSubmits=true}rows.push("page_break");hasSubmitThisRow=false;return}$tds.each(function(){var $td=$(this);var $elements=$td.find(".element_wrapper");var items=[];$elements.each(function(){var $element=$(this);var eid=$element.attr("data-element-id");var required=$element.attr("data-required");var item={};var text="";var html="";item.required=required;if(eid.match(/^nonfield_/)){var nonFieldType=eid.replace("nonfield_","");item.type=eid;if(nonFieldType=="paragraph"){html=$.trim($element.find(".editable_paragraph .paragraph_content").html());if(html!==Freeform.composerLang.dblClickEdit){item.html=html}else{item.html=""}}else if(nonFieldType=="user_recipients"){text=$.trim($element.find(".editable_userrec .element_label:first").text().replace(/\*$/gim,""));if(text!==Freeform.composerLang.notfyFriends){item.html=Freeform.formPrep(text)}else{item.html=Freeform.composerLang.notfyFriends}}else if(nonFieldType=="dynamic_recipients"){var $pItem=$element.find(".editable_dynrec");var $dataHolder=$pItem.find("[data-recipients]");var $labelHolder=$pItem.find(".element_label");var data="";var label="";var type="select";var notificationId=0;if($dataHolder.length>0){var rData=$dataHolder.attr("data-recipients");if(typeof rData==="string"){var dataTest;try{dataTest=JSON.parse($.trim(rData))}catch(e){dataTest=false}if(dataTest){data=dataTest}}var rType=$dataHolder.attr("data-type");if(rType==="select"||rType==="checks"){type=rType}var nId=parseInt($dataHolder.attr("data-notification-id"),10);if(!isNaN(nId)){notificationId=nId}}if($labelHolder.length>0&&$labelHolder.text()){label=$labelHolder.text().replace(/\*$/gim,"")}item.data=data;item.label=label;item.outputType=type;item.notificationId=notificationId}else if(nonFieldType=="submit"){hasSubmitThisRow=true;text=$.trim($element.find(".editable_submit button:first").text());if(text!==Freeform.composerLang.submit){item.html=Freeform.formPrep(text)}else{item.html=Freeform.composerLang.submit}}else if(nonFieldType=="submit_previous"){text=$.trim($element.find(".editable_submit_previous button:first").text());if(text!==Freeform.composerLang.submit_previous){item.html=Freeform.formPrep(text)}else{item.html=Freeform.composerLang.submit_previous}}}else{item.type="field";item.fieldId=Freeform.composerFieldData[eid].fieldId;fields.push(item.fieldId)}items.push(item)});row.push(items)});rows.push(row)});if(!multipage&&!hasSubmitThisRow){missingSubmits=true}var output={rows:rows,fields:fields};return JSON.stringify(output)}function cleanParagraphTags(html){return $("<div>"+html+"</div>").find(":not("+Freeform.allowedHtmlTags.join(", ")+")").removeTags().end().html()}function setDynrecEditEvents($elementWrapper){var $dynrec=$("#dynrec_editor");var $valueHolder=$(".type_value_label_holder:first",$dynrec);$dynrec.on("click",".freeform_delete_button",function(){$(this).parent().remove()});Freeform.autoDupeLastInput($valueHolder,"value_label_holder_input");Freeform.setUpChosenSelect($dynrec);$dynrec.find(".dynrec_edit.finished").click(function(e){var dynrecType=$('[name="dynrec_type"]:checked').val()=="checks"?"checks":"select";var dynrecData={};$dynrec.find(".value_label_holder_input").each(function(){var $that=$(this);var value=$.trim($that.find('[name^="list_value_holder_input"]:first').val());var label=$.trim($that.find('[name^="list_label_holder_input"]:first').val());if(value!==""&&label!==""){dynrecData[value]=label}});var dynrecLabel=$.trim($dynrec.find('[name="dynrec_output_label"]').val());var notificationId=$dynrec.find("#dynrec_notification_id").val();$elementWrapper.replaceWith(dynrec({label:Freeform.formPrep(dynrecLabel),data:dynrecData,jsonData:Freeform.formPrep(JSON.stringify(dynrecData)),type:dynrecType,notificationId:notificationId}));$.fancybox.close();e.preventDefault();return false})}$(function(){if(!!navigator.userAgent.match(/Trident\/7\./)){$("body").addClass("ie11")}_.templateSettings={evaluate:/<\{([\s\S]+?)\}>/g,interpolate:/<\{=([\s\S]+?)\}>/g,escape:/<\{-([\s\S]+?)\}>/g};$context=$("#composer_wrapper");$composer=$("#composer",$context);$singleRow=$("#single_row_button",$context);$doubleRow=$("#double_row_button",$context);$tripleRow=$("#triple_row_button",$context);$quadrupleRow=$("#quadruple_row_button",$context);$titleButton=$("#title_button",$context);$paragraphButton=$("#paragraph_button",$context);$pageBreakButton=$("#page_break_button",$context);$captchaButton=$("#captcha_button",$context);$dynamicRecipientsButton=$("#dynamic_recipients_button",$context);$userRecipientsButton=$("#user_recipients_button",$context);$submitButtonButton=$("#submit_button_button",$context);$submitPreviousButtonButton=$("#submit_previous_button_button",$context);$composerRows=$("#composer_rows",$context);$searchClear=$("#search_clear_button",$context);$composerSideBar=$("#composer_side_bar",$context);$stickyControls=$("#sticky_controls",$context);$elMcpNav=$context.closest(".col-group").find(".w-4");$mcpNav=$elMcpNav.find(".box.sidebar");toggleNavTemplate=$("#nav_toggle_template").html();captchaTemplate=$("#captcha_template").html();columnTemplate=$("#column_template").html();composerRowTemplate=$("#composer_row_template").html().replace("<{= columnTemplate }>",columnTemplate);dynrecTemplate=$("#dynrec_template").html();editDynrecTemplate=$("#edit_dynrec_template").html();editParagraphTemplate=$("#edit_paragraph_template").html();editSubmitTemplate=$("#edit_submit_button_template").html();editSubmitPreviousTemplate=$("#edit_submit_previous_button_template").html();editUserrecTemplate=$("#edit_userrec_template").html();fieldDragTemplate=$("#field_drag_template").html();fieldDragTemplate=$("#field_drag_template").html();fieldTagTemplate=$("#field_tag_template").html();fieldWrapperTemplate=$("#field_wrapper_template").html();pageBreakTemplate=$("#page_break_template").html();paragraphTemplate=$("#paragraph_template").html();submitButtonTemplate=$("#submit_button_template").html();submitPreviousButtonTemplate=$("#submit_previous_button_template").html();textareaTemplate=$("#textarea_template").html();userrecTemplate=$("#userrec_template").html();column=_.template(columnTemplate);composerRow=_.template(composerRowTemplate);dynrec=_.template(dynrecTemplate);editDynrec=_.template(editDynrecTemplate);editParagraph=_.template(editParagraphTemplate);editSubmit=_.template(editSubmitTemplate);editSubmitPrevious=_.template(editSubmitPreviousTemplate);editUserrec=_.template(editUserrecTemplate);fieldDrag=_.template(fieldDragTemplate);fieldTag=_.template(fieldTagTemplate);fieldWrapper=_.template(fieldWrapperTemplate);paragraph=_.template(paragraphTemplate);submitButton=_.template(submitButtonTemplate);submitPreviousButton=_.template(submitPreviousButtonTemplate);userrec=_.template(userrecTemplate);$elMcpNav.append($composerSideBar);$elMcpNav.parents(".col-group").css("position","relative");$mcpNav.addClass("mcp-side-nav-dropdown");$navTemplate=$(toggleNavTemplate);$mcpNav.append($navTemplate);$navTemplate.click(function(e){$mcpNav.toggleClass("shown")});var pageBreakOutputTemplate=composerRow({data:[pageBreakTemplate],colspan:"12",notSortable:false});setRowButtonEvents($singleRow,"single",1);setRowButtonEvents($doubleRow,"double",2);setRowButtonEvents($tripleRow,"triple",3);setRowButtonEvents($quadrupleRow,"quadruple",4);$pageBreakButton.click(function(){var $element=$(pageBreakOutputTemplate);$element.addClass("page_break_holder no_sort").appendTo($composerRows);updateRowEvents($element,"row")});$pageBreakButton.draggable({connectToSortable:"#composer_rows",forceHelperSize:true,zIndex:50,helper:function(){sortOut=false;return $(this).clone().addClass("insert_element_width taller").css("text-align","center").height($(this).outerHeight()).remove().appendTo($composer).css({zIndex:55,paddingRight:0})}});setInsertButtonEvent($titleButton,"<h2>"+Freeform.composerLang.formLabel+"</h2>");setInsertButtonEvent($captchaButton,captchaTemplate);setInsertButtonEvent($submitButtonButton,submitButton());setInsertButtonEvent($submitPreviousButtonButton,submitPreviousButton());setInsertButtonEvent($paragraphButton,paragraph());setInsertButtonEvent($dynamicRecipientsButton,dynrec());setInsertButtonEvent($userRecipientsButton,userrec());$composer.on("dblclick",".element_wrapper:has(.editable_paragraph)",function(){var $that=$(this);var $pItem=$that.find(".editable_paragraph");var data=$pItem.find(".paragraph_content").html();var inputData=Freeform.composerLang.dblClickEdit==$.trim(data)?"":$.trim(data);$pItem.replaceWith(editParagraph({data:Freeform.formPrep(inputData)}));$that.find(".element_cover").hide();$that.find(".editor textarea").get(0).focus()});$composer.on("click",".element_wrapper .paragraph_edit.finished",function(){var $that=$(this);var $wrapper=$that.closest(".element_wrapper");var $editor=$wrapper.find(".editor");var $pItem=$editor.find("textarea:first");var data=$.trim($pItem.val());var inputData=Freeform.composerLang.dblClickEdit;if(data!==""&&data!==inputData){$.fancybox.showActivity();inputData=cleanParagraphTags(Security.xssClean(data));$.fancybox.hideActivity()}$editor.replaceWith(paragraph({data:inputData}));$wrapper.find(".element_cover").show()});$composer.on("dblclick",".element_wrapper:has(.editable_submit)",function(){var $that=$(this);var $pItem=$that.find(".editable_submit");var data=$pItem.find(" button:first").text();var inputData=Freeform.composerLang.submit==$.trim(data)?"":$.trim(data);$pItem.replaceWith(editSubmit({data:Freeform.formPrep(inputData)}));$that.find(".element_cover").hide();$that.find(".editor input").get(0).focus()});$composer.on("dblclick",".element_wrapper:has(.editable_submit_previous)",function(){var $that=$(this);var $pItem=$that.find(".editable_submit_previous");var data=$pItem.find(" button:first").text();var inputData=Freeform.composerLang.submit_previous==$.trim(data)?"":$.trim(data);$pItem.replaceWith(editSubmitPrevious({data:Freeform.formPrep(inputData)}));$that.find(".element_cover").hide();$that.find(".editor input").get(0).focus()});$composer.on("click",".element_wrapper .submit_edit.finished",function(){var $that=$(this);var $wrapper=$that.closest(".element_wrapper");var $editor=$wrapper.find(".editor");var $pItem=$editor.find('input[name="submit_edit"]:first');var data=$.trim($pItem.val());var inputData=Freeform.composerLang.submit;if(data!==""&&data!==inputData){inputData=Freeform.formPrep(data)}$editor.replaceWith(submitButton({data:inputData}));$wrapper.find(".element_cover").show()});$composer.on("click",".element_wrapper .submit_previous_edit.finished",function(){var $that=$(this);var $wrapper=$that.closest(".element_wrapper");var $editor=$wrapper.find(".editor");var $pItem=$editor.find('input[name="submit_previous_edit"]:first');var data=$.trim($pItem.val());var inputData=Freeform.composerLang.submit_previous;if(data!==""&&data!==inputData){inputData=Freeform.formPrep(data)}$editor.replaceWith(submitPreviousButton({data:inputData}));$wrapper.find(".element_cover").show()});$composer.on("dblclick",".element_wrapper:has(.editable_userrec)",function(){var $that=$(this);var $pItem=$that.find(".editable_userrec");var data=$pItem.find(".element_label").text().replace(/\*$/gim,"");var inputData=Freeform.composerLang.notfyFriends==$.trim(data)?"":$.trim(data);$pItem.replaceWith(editUserrec({data:Freeform.formPrep(inputData)}));$that.find(".element_cover").hide();$that.find(".editor input").get(0).focus()});$composer.on("click",".element_wrapper .userrec_edit.finished",function(){var $that=$(this);var $wrapper=$that.closest(".element_wrapper");var $editor=$wrapper.find(".editor");var $pItem=$editor.find('input[name="userrec_edit"]:first');var data=$.trim($pItem.val());var inputData=Freeform.composerLang.notfyFriends;if(data!==""&&data!==inputData){inputData=Freeform.formPrep(data)}$editor.replaceWith(userrec({data:inputData}));$wrapper.find(".element_cover").show()});$composer.on("dblclick",".element_wrapper:has(.editable_dynrec)",function(){var $that=$(this);var $pItem=$that.find(".editable_dynrec");var $dataHolder=$pItem.find("[data-recipients]");var $labelHolder=$pItem.find(".element_label");var data="";var label="";var type="select";var notificationId=0;if($dataHolder.length>0){var rData=$dataHolder.attr("data-recipients");if(typeof rData==="string"){try{data=JSON.parse($.trim(rData))}catch(e){data=""}}var rType=$dataHolder.attr("data-type");if(rType==="select"||rType==="checks"){type=rType}var nId=parseInt($dataHolder.attr("data-notification-id"),10);if(!isNaN(nId)){notificationId=nId}}if($labelHolder.length>0&&$labelHolder.text()){label=$labelHolder.text().replace(/\*$/gim,"")}$.fancybox(_.extend(fieldFancyboxDefaults,{content:editDynrec({data:data,label:Freeform.formPrep(label),type:type,notificationId:notificationId}),onComplete:function(){$(this).stop();$.fancybox.center();setDynrecEditEvents($pItem)}}))});$("#field_list").on("click",".field_tag",function(e){var $that=$(this),fieldName=$that.attr("data-field-name");if($that.hasClass("disabled")){return false}var $element=$(composerRow({data:[fieldOutput(fieldName)],colspan:"12"}));$element.appendTo($composerRows);$that.addClass("disabled");updateRowEvents($element,"row");e.preventDefault();return false});$.get(Freeform.url.newField,function(data){Freeform.newFieldHtml=data;$("#new_field_button").fancybox(_.extend(fieldFancyboxDefaults,{content:Freeform.newFieldHtml,onComplete:function(){fieldModalEvents(this)}}))});$("#field_list").on("click",".field_tag .freeform_edit_button",function(e){var $that=$(this),fieldName=$that.parent().attr("data-field-name"),fieldData=Freeform.composerFieldData[fieldName];$.fancybox.showActivity();$.post(fieldData.fieldEditUrl,function(data){$.fancybox(_.extend(fieldFancyboxDefaults,{content:data,onComplete:function(){fieldModalEvents(this,fieldName)}}))});e.preventDefault();return false});$composerRows.sortable({handle:".row_control .freeform_drag_button",containment:"#composer > table tbody",axis:"y",items:"tr",forceHelperSize:true,helper:function(e,ui){ui.children().each(function(){var $that=$(this);$that.width($that.outerWidth())});return ui},receive:function(event,ui){var $that=$(this);var $element;var $item=$that.data()["ui-sortable"].currentItem;sortOut=true;if(ui.item.is('[id$="_row_button"]')){var name=ui.item.attr("id").replace("_row_button","");$element=$(rowTemplates[name]);if($item.hasClass("disabled")){$item.remove()}else{$item.replaceWith($element)}setTimeout(function(){updateRowEvents($element,"row")},0)}else if(ui.item.attr("data-element-id")=="page_break"){$element=$(pageBreakOutputTemplate);$element.addClass("page_break_holder no_sort");$item.replaceWith($element);setTimeout(function(){updateRowEvents($element,"row")},0)}return ui},over:function(e,ui){sortOut=true}});$composer.droppable({accept:".row_button",drop:function(event,ui){if(ui.draggable.attr("id")){$("#"+ui.draggable.attr("id")).click()}else if(sortOut){sortOut=false}else{setTimeout(function(){if(sortOut){return}var name=/[a-z]+\_row\_button/g.exec(ui.draggable.attr("class"));if(typeof name[0]!=="undefined"){$("#"+name[0]).click()}},0)}}});$composer.on("click",".element_control .element_require",function(e){var $that=$(this);$that.closest(".element_wrapper").attr("data-required","yes");e.preventDefault();return false});$composer.on("click",".element_control .element_unrequire",function(e){var $that=$(this);$that.closest(".element_wrapper").attr("data-required","no");e.preventDefault();return false});$composer.on("click",".element_control .element_delete",function(e){var $that=$(this);$that.closest(".element_wrapper").remove();checkRemovedFields();e.preventDefault();return false});$composer.on("click",".row_control .row_delete, "+".page_break_holder .freeform_delete_button",function(e){var $that=$(this);$that.closest("tr").remove();checkRemovedFields();e.preventDefault();return false});$composer.on("click",".row_control .row_add_column",function(e){var $that=$(this),$tr=$that.closest("tr"),$tds=$tr.find("td:not(.row_control_holder)");if($tds.length<4){var colspan=12/($tds.length+1);$tds.last().after(column({colspan:colspan}));$tds=$tr.find("td:not(.row_control_holder)");$tds.attr("colspan",colspan).css("width",Freeform.fractionToFloat(colspan,12,96)+"%")}checkRowControls();updateRowEvents();e.preventDefault();return false});$composer.on("click",".row_control .row_remove_column",function(e){var $that=$(this),$tr=$that.closest("tr"),$tds=$tr.find("td:not(.row_control_holder)");if($tds.length>1){var colspan=12/($tds.length-1);$tds.last().remove();$tds=$tr.find("td:not(.row_control_holder)");$tds.attr("colspan",colspan).css("width",Freeform.fractionToFloat(colspan,12,96)+"%")}checkRowControls();checkRemovedFields();e.preventDefault();return false});setFieldDragging();var previewId=0;var previousComposerJSON="";var showPreview=function(){var composerTemplate=$("#composer_template_select").val();var composerUrl=Freeform.url.composerPreview+"&preview_id="+previewId+"&template_id="+composerTemplate+"&cache_bust="+(new Date).getTime();$.fancybox(_.extend(_.clone(fieldFancyboxDefaults),{width:"95%",height:"95%",type:"iframe",href:composerUrl,title:Freeform.composerLang.previewTitle+": "+Freeform.composerLang.formLabel,onComplete:function(){$(this).stop();$.fancybox.center()}}))};var checkPreview=function(composerJSON){$.fancybox.showActivity();if(composerJSON!==previousComposerJSON){$.post(Freeform.url.composerSave,{preview:"y",composer_data:composerJSON,XID:EE.CSRF_TOKEN||Freeform.XID},function(data){previousComposerJSON=composerJSON;previewId=data.composerId;showPreview()},"json")}else{showPreview()}};var ignoreSubmitError=typeof Freeform.disableMissingSubmit!=="undefined"&&Freeform.disableMissingSubmit===true;$("#preview").click(function(e){var composerJSON=getComposerRows();if(!ignoreSubmitError&&missingSubmits){Freeform.jQUIDialog({immediate:true,cancel:Freeform.composerLang.cancel,cancelClick:function(){},ok:Freeform.composerLang.continueAnyway,okClick:function(){checkPreview(composerJSON)},message:Freeform.composerLang.missingSubmits})}else{checkPreview(composerJSON)}e.preventDefault();return false}).css("cursor","pointer");var $saveForm=$("#save_composer");var submitRedirect=true;function saveComposer(e,redirect){redirect=submitRedirect===false?false:true;$.fancybox.showActivity();var composerJSON=getComposerRows();if(!ignoreSubmitError&&missingSubmits){$.fancybox.hideActivity();Freeform.jQUIDialog({immediate:true,modal:true,cancel:Freeform.composerLang.cancel,cancelClick:function(){},ok:Freeform.composerLang.continueAnyway,okClick:function(){ignoreSubmitError=true;$("#save_composer").submit()},message:Freeform.composerLang.missingSubmits});e.preventDefault();return false}$("#composer_save_data").val(composerJSON);$("#composer_template_id").val($("#composer_template_select").val());if(!redirect){$.post($saveForm.attr("action"),$saveForm.serialize(),function(e){$.fancybox.hideActivity()});e.preventDefault();return false}}$("#save_composer").submit(saveComposer);$("#save_and_finish").click(function(e){submitRedirect=true}).css("cursor","pointer");$("#quicksave").click(function(e){submitRedirect=false}).css("cursor","pointer");$("#clear_all").click(function(){Freeform.jQUIDialog({immediate:true,cancel:Freeform.composerLang.cancel,cancelClick:function(){},ok:Freeform.composerLang.ok,okClick:function(){$composer.find(".row_control .row_delete, "+".page_break_holder .freeform_delete_button").click()},message:Freeform.composerLang.clearAllWarn})});if(typeof Freeform.composerLayoutData.rows!=="undefined"){setTimeout(function(){var rk,rl,ck,cl,fk,fl;var columns,fields,row,columnData;var rows=Freeform.composerLayoutData.rows;var pageCount=1;for(rk=0,rl=rows.length;rk<rl;rk++){if(rows[rk]=="page_break"){$pageBreakButton.click();pageCount++;continue}columns=rows[rk];row=[];for(ck=0,cl=columns.length;ck<cl;ck++){fields=columns[ck];columnData="";for(fk=0,fl=fields.length;fk<fl;fk++){if(fields[fk].type=="nonfield_title"){columnData+=insertOutputs["title"]}else if(fields[fk].type=="nonfield_paragraph"){if(fields[fk].html===""){columnData+=insertOutputs["paragraph"]}else{columnData+=fieldWrapper({elementId:"nonfield_paragraph",element:paragraph({data:fields[fk].html})})}}else if(fields[fk].type=="nonfield_user_recipients"){if(fields[fk].html===""){columnData+=insertOutputs["paragraph"]}else{columnData+=fieldWrapper({elementId:"nonfield_user_recipients",element:userrec({data:fields[fk].html}),requireable:"yes",reqiured:typeof fields[fk].required!=="undefined"&&fields[fk].required=="yes"?"yes":"no"})}}else if(fields[fk].type=="nonfield_dynamic_recipients"){if(fields[fk].html===""){columnData+=insertOutputs["dynrec"]}else{columnData+=fieldWrapper({elementId:"nonfield_dynamic_recipients",element:dynrec({jsonData:Freeform.formPrep(JSON.stringify(fields[fk].data)),data:fields[fk].data,label:Freeform.formPrep(fields[fk].label),type:fields[fk].outputType,notificationId:typeof fields[fk].notificationId!=="undefined"?fields[fk].notificationId:0}),requireable:"yes",required:typeof fields[fk].required!=="undefined"&&fields[fk].required=="yes"?"yes":"no"})}}else if(fields[fk].type=="nonfield_captcha"){columnData+=insertOutputs["captcha"]}else if(fields[fk].type=="nonfield_submit"){if(typeof fields[fk].html==="undefined"||fields[fk].html===""){columnData+=insertOutputs["submit"]}else{columnData+=fieldWrapper({elementId:"nonfield_submit",element:submitButton({data:Freeform.formPrep(fields[fk].html)})})}}else if(fields[fk].type=="nonfield_submit_previous"){if(typeof fields[fk].html==="undefined"||fields[fk].html===""){columnData+=insertOutputs["submit_previous"]}else{columnData+=fieldWrapper({elementId:"nonfield_submit_previous",element:submitPreviousButton({data:Freeform.formPrep(fields[fk].html)})})}}else if(fields[fk].type=="field"&&typeof fields[fk].fieldId!=="undefined"&&typeof Freeform.composerFieldIdList[fields[fk].fieldId]!=="undefined"){columnData+=fieldOutput(Freeform.composerFieldIdList[fields[fk].fieldId],typeof fields[fk].required!=="undefined"&&fields[fk].required=="yes"?"yes":"no")}}row.push(columnData)}var $element=$(composerRow({data:row,colspan:12/row.length})).appendTo($composerRows);updateRowEvents($element,"row");checkRemovedFields()}},0)}else{$titleButton.click()}var sideBartop=$composerSideBar.offset().top-parseFloat($composerSideBar.css("margin-top").replace(/auto/,0));var sideBarHeight=$composerSideBar.outerHeight();var $elNavChild=$elMcpNav.children().first();var sideBarWidth=$elNavChild.outerWidth();var $uiWrapper=$("#composer_wrapper");var uiWrapperTop=$uiWrapper.offset().top-parseFloat($uiWrapper.css("margin-top").replace(/auto/,0));var uiWrapperHeight;Freeform.elementSearch("#search_fields","#field_list .field_tag",".field_label","html");$searchClear.click(function(){$("#search_fields").val("").keyup();$searchClear.hide()}).hide();var searchClearInt=0;$("body").on("keyup","#search_fields",function(e){var $that=$(this);clearTimeout(searchClearInt);searchClearInt=setTimeout(function(){if($.trim($that.val())===""||$that.attr("placeholder")&&$that.val()==$that.attr("placeholder")){$searchClear.hide()}else{$searchClear.show()}},100)})})})(window,jQuery);